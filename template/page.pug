extends layout.pug

append head
  link(rel='stylesheet', type='text/css', href='../page-style.css')
  include include/mathjax.pug
  script(type='text/javascript', src='../arbital-demo-bundle.js')
  script(type='text/javascript').
    window.addEventListener('DOMContentLoaded', e=>window.loadAllDemos())

block body
  header
    h1.title= title
    div.page-info
      p.metadata-link: a(href=`../metadata/${aliasOrId}.json.html`)= `${aliasOrId}.json`
      p.arbital-url: a(href=arbitalUrl)= arbitalUrl
      if pageCreatorId
        p.creator
          | by
          | 
          +pageLink(pageCreatorId)
          if pageCreatedAt
            | 
            = dateFormat(pageCreatedAt, 'mmm d yyyy')
          if editCreatedAt && editCreatedAt > pageCreatedAt
            | 
            | updated
            | 
            = dateFormat(editCreatedAt, 'mmm d yyyy')
    if clickbait
      p.clickbait= clickbait
    nav.breadcrumbs
      +breadcrumb(title)
      for breadcrumb in breadcrumbs
        +breadcrumbWithoutIndex(...breadcrumb)
  hr
  main!= textHtml
  hr
  if commentIds.length > 0
    section.comments
      h2 Comments
      each commentId in commentIds
        - let comment = pageIndex[commentId] 
        div.comment
          if comment
            p: +pageLink(comment.pageCreatorId)
          p!= comment && comment.renderText ? comment.renderText(pageIndex) : `${commentId} (missing)`
  footer
    if tagIds.length > 0
      p.tagged
        h2 Tagged
        +pageCommaList(tagIds)
    if creatorIds.length > 1
      p.all-creators
        h2 All Creators
        +pageCommaList(creatorIds)
    if individualLikes.length > 0
      p.likes
        h2 Likes
        +pageCommaList(individualLikes)
    if relatedIds.length > 0
      p.related
        h2 Related
        +pageList(relatedIds)
    if reverse.relatedIds.size > 0
      p.reverse-related
        h2 Reverse Related
        +pageList(reverse.relatedIds)
    if childIds.length > 0
      p.children
        h2 Children
        +pageTree(childIds)
    if reverse.pageCreatorId.size > 0 || reverse.editorIds.size > 0
      hr
    if reverse.pageCreatorId.size > 0
      p.created
        h2 Created
        +pageListByType(reverse.pageCreatorId, /*hLevel=*/3, /*idPrefix=*/'created', /*skipCreator=*/true)
    if reverse.editorIds.size > 0
      p.edited
        h2 Edited
        +pageListByType(reverse.editorIds, /*hLevel=*/3, /*idPrefix=*/'edited')
